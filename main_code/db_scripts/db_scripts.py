import psycopg2
from psycopg2.extras import execute_values
from config import DB_NAME, DB_USER, DB_PASSWORD, DB_HOST, DB_PORT

def add_to_db(name, vector):
    try:
        conn = psycopg2.connect(
            dbname=DB_NAME,
            user=DB_USER,
            password=DB_PASSWORD,
            host=DB_HOST,
            port=DB_PORT
        )
        cursor = conn.cursor()

        execute_values(
            cursor,
            "INSERT INTO faces (name, vector) VALUES %s",
            [(name, vector)]
        )

        conn.commit()

    except Exception as e:
        print(f"Ошибка при добавлении в БД: {e}")
        if 'conn' in locals():
            conn.rollback()
        raise
    finally:
        if 'conn' in locals():
            cursor.close()
            conn.close()


def get_from_db():
    try:
        conn = psycopg2.connect(
            dbname=DB_NAME,
            user=DB_USER,
            password=DB_PASSWORD,
            host=DB_HOST,
            port=DB_PORT
        )
        cursor = conn.cursor()

        cursor.execute("SELECT name, vector FROM faces")
        faces = cursor.fetchall()

        if not faces:
            print("Нет данных для обработки")
            return []

        return faces

    except Exception as e:
        print(f"Ошибка при получении из БД: {e}")
        if 'conn' in locals():
            conn.rollback()
        raise
    finally:
        if 'conn' in locals():
            cursor.close()
            conn.close()


if __name__ == "__main__":
    add_to_db('Dmitry Filatov', [-0.11975168436765671, 0.03865577094256878, -0.015077005761365095, -0.06645966817935307, -0.10476713627576828, -0.021485850525399048, 0.05054474125305811, 0.010116548587878546, 0.183576966325442, -0.13688978304465613, 0.20289122561613718, -0.006168823689222336, -0.23619825144608816, -0.018125937165071566, 0.018821333224574726, 0.1537176271279653, -0.10072015474239986, -0.16131705542405447, -0.09688849498828252, -0.17950884501139322, 0.024373145153125126, 0.07618884618083636, -0.06902650495370229, 0.060166106869777046, -0.08985947569211324, -0.24887831012407938, -0.07767854010065396, -0.06240436186393102, 0.06737231463193893, -0.14130917688210806, 0.07069244608283043, 0.1542282154162725, -0.07716405640045802, -0.02751986061533292, 0.030096715316176414, 0.060274429619312286, -0.08739918967088063, -0.06643719226121902, 0.2519725412130356, 0.04415084421634674, -0.14074890315532684, -0.04443238737682501, 0.032437183583776154, 0.3793720602989197, 0.15517228096723557, -0.037050193175673485, 0.031014997512102127, -0.028180772438645363, 0.11589435736338298, -0.23813190559546152, 0.028734438121318817, 0.1421843965848287, 0.13352404038111368, 0.09393420815467834, 0.054078626135985054, -0.09758301079273224, -0.0016673287997643154, 0.14925678571065268, -0.227098415295283, 0.08397283405065536, 0.026142995804548264, -0.15653822322686514, -0.10006959984699886, -0.0982285737991333, 0.1753764053185781, 0.07721720387538274, -0.12593687822421393, -0.17037004232406616, 0.2086645315090815, -0.17490947743256888, -0.1405071715513865, 0.1215769425034523, -0.11563422034184138, -0.17146862546602884, -0.22118785977363586, 0.050043399135271706, 0.3604648510615031, 0.14832576860984167, -0.1291062831878662, 0.06064041952292124, 0.03454681858420372, -0.08284984280665715, 0.05702300928533077, 0.14969048897425333, -0.06458192070325215, -0.05274927616119385, -0.056691233068704605, 0.05263516182700793, 0.1834226300319036, -0.0008754897862672806, -0.11120986690123875, 0.16140294323364893, 0.05264777814348539, 0.002275558498998483, 0.029569390540321667, 0.07108695184191068, -0.04212351764241854, -0.03456962170700232, -0.11843964209159215, -0.0650246540705363, 0.044115944455067314, -0.09220873564481735, -0.03357046516612172, 0.07548486565550168, -0.09740553299585979, 0.27823831637700397, -0.002669196343049407, 0.029726157585779827, -0.08276635160048802, 0.0011066130828112364, -0.06290927777687709, 0.048338508854309716, 0.14801812171936035, -0.21984689931074777, 0.12389777600765228, 0.15939985712369284, 0.02917453957100709, 0.142165869474411, 0.045001380145549774, 0.044272229075431824, 0.021444895925621193, -0.0807628184556961, -0.20644200344880423, -0.09948869422078133, 0.04807323838273684, 0.01747151215871175, 0.06241572896639506, 0.0418398454785347])
    print(get_from_db())